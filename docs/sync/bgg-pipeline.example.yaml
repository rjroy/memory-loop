# BoardGameGeek Sync Pipeline - Example Configuration
#
# This example shows how to configure a sync pipeline that fetches board game
# metadata from BoardGameGeek (BGG) and writes it to your vault's markdown files.
#
# File Location: .memory-loop/sync/bgg.yaml
#
# Spec Requirements:
# - REQ-F-1: Pipeline config in .memory-loop/sync/*.yaml
# - REQ-F-2: Specifies connector, matching, field mappings, transformations
# - REQ-F-3: Files matched by frontmatter field value
# - REQ-F-4: Support for namespace or direct field mapping
# - REQ-F-5: Per-field merge strategies
# - REQ-F-12: Vocabulary normalization mappings
# ============================================================================

# ---------------------------------------------------------------------------
# Pipeline Identification
# ---------------------------------------------------------------------------

# Human-readable name for this pipeline (appears in sync status messages)
name: Board Games BGG Sync

# API connector identifier. Currently supported: "bgg"
# The connector determines how data is fetched and what fields are available.
connector: bgg

# ---------------------------------------------------------------------------
# File Matching
# ---------------------------------------------------------------------------

# Configuration for finding files to sync
match:
  # Frontmatter field containing the external ID to fetch
  # Example: a file with `bgg_id: 174430` will fetch Gloomhaven's data
  field: bgg_id

  # Glob pattern for candidate files (relative to vault root)
  # Only files matching this pattern AND having the match field will be synced
  # Examples:
  #   Games/**/*.md       - All .md files in Games/ and subdirectories
  #   Library/Games/*.md  - Only direct children of Library/Games/
  #   **/*game*.md        - Any .md file with "game" in the name
  pattern: Games/**/*.md

# ---------------------------------------------------------------------------
# Default Settings
# ---------------------------------------------------------------------------

# Default settings applied to all field mappings (can be overridden per-field)
defaults:
  # Default merge strategy for synced data
  # Options:
  #   overwrite - Always replace existing value with synced value
  #   preserve  - Keep existing value if present, use synced value if not
  #   merge     - For arrays, combine values without duplicates
  merge_strategy: overwrite

  # Namespace prefix for synced fields
  # When set, field targets are prefixed: "rating" becomes "bgg.rating"
  # When omitted or empty, fields are written at the root level
  # Useful for keeping synced data separate from user-edited fields
  namespace: bgg

# ---------------------------------------------------------------------------
# Field Mappings
# ---------------------------------------------------------------------------

# Map API fields to frontmatter fields
# Each mapping specifies:
#   - source: Field name from the API connector
#   - target: Field name in frontmatter (namespace prefix applied if set)
#   - strategy: Override default merge strategy (optional)
#   - normalize: Apply vocabulary normalization (optional, default: false)
#
# Available BGG source fields:
#   - name: Primary game name (string)
#   - rating: BGG average rating (number, 0-10)
#   - weight: Game complexity/weight (number, 1-5)
#   - minPlayers: Minimum player count (number)
#   - maxPlayers: Maximum player count (number)
#   - minPlaytime: Minimum play time in minutes (number)
#   - maxPlaytime: Maximum play time in minutes (number)
#   - yearPublished: Year the game was published (number)
#   - mechanics: Game mechanisms (string array)
#   - categories: Game categories (string array)
fields:
  # Basic game information
  - source: name
    target: title
    # Preserve user's custom title if they've set one
    strategy: preserve

  - source: yearPublished
    target: year

  # Numeric ratings and stats
  - source: rating
    target: rating

  - source: weight
    target: complexity

  # Player count as nested object
  - source: minPlayers
    target: players_min

  - source: maxPlayers
    target: players_max

  # Playtime
  - source: minPlaytime
    target: playtime_min

  - source: maxPlaytime
    target: playtime_max

  # Categories and mechanics as arrays
  # Use merge strategy to combine synced values with user additions
  - source: categories
    target: categories
    strategy: merge

  - source: mechanics
    target: mechanics
    # Enable vocabulary normalization for consistent mechanic names
    normalize: true
    # Merge lets users add their own mechanics while keeping synced ones
    strategy: merge

# ---------------------------------------------------------------------------
# Vocabulary Normalization (LLM-assisted)
# ---------------------------------------------------------------------------

# Define canonical terms and their known variations
# When a field has `normalize: true`, the LLM maps incoming values to these
# canonical terms. Unmapped values are preserved as-is.
#
# Format:
#   "Canonical Term":
#     - "variation 1"
#     - "variation 2"
#
# The LLM uses these mappings as context to normalize similar terms even if
# not explicitly listed (e.g., "Worker-Placement" would map to "Worker Placement")
vocabulary:
  # Common game mechanisms (from BGG's mechanic categories)
  "Worker Placement":
    - "worker placement"
    - "Worker placement game"
    - "Action Point Allowance System"

  "Deck Building":
    - "deck building"
    - "Deckbuilding"
    - "Card Building"
    - "Deck / Pool Building"

  "Area Control":
    - "area control"
    - "Area Majority / Influence"
    - "Territory Control"

  "Hand Management":
    - "hand management"
    - "Card Management"
    - "Hand Building"

  "Drafting":
    - "drafting"
    - "Card Drafting"
    - "Action Drafting"
    - "Variable Player Powers"

  "Cooperative":
    - "cooperative"
    - "Co-operative Game"
    - "Co-op"
    - "Team-Based Game"

  "Campaign":
    - "campaign"
    - "Legacy"
    - "Campaign / Battle Card Driven"
    - "Scenario / Mission / Campaign Game"

  "Dice Rolling":
    - "dice rolling"
    - "Dice"
    - "Die Rolling"

  "Set Collection":
    - "set collection"
    - "Set Building"
    - "Pattern Building"

  "Tile Placement":
    - "tile placement"
    - "Tile Laying"
    - "Modular Board"

# ============================================================================
# RESULT
# ============================================================================
#
# After sync, a file like this:
#
#   ---
#   bgg_id: 174430
#   my_notes: "Great campaign game!"
#   ---
#   # Gloomhaven
#
# Will be updated to:
#
#   ---
#   bgg_id: 174430
#   my_notes: "Great campaign game!"
#   bgg:
#     title: Gloomhaven
#     year: 2017
#     rating: 8.57
#     complexity: 3.87
#     players_min: 1
#     players_max: 4
#     playtime_min: 60
#     playtime_max: 120
#     categories:
#       - Adventure
#       - Exploration
#       - Fantasy
#       - Fighting
#       - Miniatures
#     mechanics:
#       - Cooperative
#       - Hand Management
#       - Campaign
#       - Deck Building
#   _sync_meta:
#     last_synced: "2026-01-15T10:30:00Z"
#     source: bgg
#     source_id: "174430"
#   ---
#   # Gloomhaven
#
# Note how:
# - User's `my_notes` field is preserved (not touched by sync)
# - All BGG fields are nested under `bgg:` namespace
# - Mechanics are normalized ("Co-operative Game" -> "Cooperative")
# - `_sync_meta` tracks when this file was last synced
# ============================================================================

# ============================================================================
# ALTERNATIVE CONFIGURATIONS
# ============================================================================

# --- Direct Field Mapping (no namespace) ---
# Remove or clear `defaults.namespace` to write fields at root level:
#
#   defaults:
#     merge_strategy: overwrite
#     # namespace: (omitted)
#
# Result:
#   ---
#   bgg_id: 174430
#   title: Gloomhaven
#   rating: 8.57
#   mechanics:
#     - Cooperative
#   ---

# --- Preserve-First Strategy ---
# Use `preserve` as default to never overwrite user edits:
#
#   defaults:
#     merge_strategy: preserve
#     namespace: synced
#
# Fields will only be written on first sync, then frozen.

# --- Minimal Sync (just rating) ---
# Only sync specific fields:
#
#   fields:
#     - source: rating
#       target: bgg_rating
#     - source: weight
#       target: bgg_weight

# ============================================================================
# SECRETS
# ============================================================================

# If your API requires authentication, create a secrets file:
#
# File: .memory-loop/secrets/bgg.yaml
#
#   bgg_username: your_username
#   anthropic_key: sk-ant-...
#
# Important:
# - Secrets files should be encrypted with git-crypt
# - Add `.memory-loop/secrets/` to .gitignore as backup
# - Secrets are referenced by key name in connectors that need them
# - The vocabulary normalizer uses the Anthropic API key for LLM calls

# ============================================================================
