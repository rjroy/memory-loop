---
version: 1.0.0
status: Approved
created: 2025-12-31
last_updated: 2025-12-31
authored_by:
  - Ronald Roy <gsdwig@gmail.com>
---

# Task List Specification

## Executive Summary

Add a Task List view to the Recall tab that displays markdown tasks from vault directories. Users can toggle between the existing File Tree and the new Task List by clicking the "Files" header. Tasks are grouped by file, sortable, and can be marked complete/incomplete directly from the UI.

This feature surfaces actionable items from across the vault in one view, reducing friction for task-focused workflows without requiring users to navigate the file tree.

## User Story

As a vault user, I want to see all my tasks in one list, so that I can quickly review and complete them without navigating through files.

## Stakeholders

- **Primary**: Vault users who track tasks in markdown
- **Secondary**: Developers maintaining the codebase
- **Tertiary**: Mobile users, future feature developers (filtering/search builds on this)

## Success Criteria

1. Tasks from inbox, projects, and areas directories appear in a single list
2. Users can toggle a task's completion state and the change persists to the file
3. Toggle between File Tree and Task List executes without errors on desktop and mobile with identical functionality
4. Task list loads in under 2 seconds for vaults with 500 tasks
5. All task checkboxes meet 44px minimum touch target height

## Functional Requirements

### Configuration

- **REQ-F-1**: Add `projectPath` to VaultConfig with default `01_Projects`
- **REQ-F-2**: Add `areaPath` to VaultConfig with default `02_Areas`
- **REQ-F-3**: Configuration paths are relative to contentRoot (same as inboxPath)

### Task Discovery

- **REQ-F-4**: Scan files in inboxPath, projectPath, and areaPath directories recursively
- **REQ-F-5**: Parse markdown task entries matching `/^\s*- \[(.)\] (.+)$/`
- **REQ-F-6**: Extract checkbox state from captured character:
  - ` ` (space) = incomplete
  - `x` = complete
  - `/` = partial
  - `?` = needs info
  - `b` = bookmarked
  - `f` = urgent
- **REQ-F-7**: Capture task text, file path, and line number for each task

### Task List Display

- **REQ-F-8**: Group tasks by source file
- **REQ-F-9**: Sort by file path, then by line number within file
- **REQ-F-10**: Display rollup count as "incomplete / total" (e.g., "12 / 45") where incomplete = space only
- **REQ-F-11**: Show task text with visual indicator for each state:
  - ` ` = empty checkbox
  - `x` = checked checkbox
  - `/` = half-filled indicator
  - `?` = question mark indicator
  - `b` = üìç emoji
  - `f` = üî• emoji

### Task Interaction

- **REQ-F-12**: Clicking a task indicator cycles through states: ` ` ‚Üí `x` ‚Üí `/` ‚Üí `?` ‚Üí `b` ‚Üí `f` ‚Üí ` `
- **REQ-F-13**: Write the updated line back to the source file
- **REQ-F-14**: Refresh the task's display state after successful write

### View Toggle

- **REQ-F-15**: Clicking "Files" header cycles between File Tree and Task List
- **REQ-F-16**: Toggle works identically on desktop and mobile
- **REQ-F-17**: Persist view preference in browser (localStorage)

### WebSocket Protocol

- **REQ-F-18**: Add `get_tasks` client message to request task list
- **REQ-F-19**: Add `tasks` server message returning task list with metadata
- **REQ-F-20**: Add `toggle_task` client message with file path and line number
- **REQ-F-21**: Add `task_toggled` server message confirming the toggle

### Error Handling

- **REQ-F-22**: When directory paths don't exist, treat as empty (0 tasks from that path)
- **REQ-F-23**: When no tasks exist, display "No tasks found"
- **REQ-F-24**: When file write fails, show error toast with file path; checkbox remains unchanged

## Non-Functional Requirements

- **REQ-NF-1** (Performance): Task list loads in under 2 seconds for vaults with 500 tasks
- **REQ-NF-2** (Usability): Touch targets meet 44px minimum height
- **REQ-NF-3** (Consistency): Task List styling matches existing File Tree component
- **REQ-NF-4** (Reliability): Failed writes show error without losing user's place in list

## Explicit Constraints (DO NOT)

- Do NOT create a separate "Tasks" tab; use existing Recall tab with toggle
- Do NOT add task creation; only display and toggle existing tasks
- Do NOT scan directories outside inbox/projects/areas paths
- Do NOT support nested task lists or sub-tasks (flat list only)
- Do NOT add filtering or search in MVP scope
- Do NOT modify task text content, only checkbox state

## Technical Context

- **Existing Stack**: React 19, Hono backend, WebSocket protocol with Zod validation
- **Integration Points**: VaultConfig, protocol.ts schemas, BrowseMode component
- **Patterns to Respect**:
  - Zod schemas for all WebSocket messages
  - SessionContext for frontend state
  - CSS follows BEM naming (file-tree__*, browse-mode__*)

## Acceptance Tests

1. **Config defaults**: New vault without .memory-loop.json uses `01_Projects` and `02_Areas`
2. **Task parsing**: Line `  - [ ] Buy groceries` parsed as incomplete task with text "Buy groceries"
3. **Task parsing complete**: Line `- [x] Done item` parsed as complete task
4. **Rollup count**: 3 incomplete of 5 total displays as "3 / 5"
5. **State cycle**: Clicking indicator on `- [ ] Task` writes `- [x] Task`, clicking again writes `- [/] Task`, continues through cycle
6. **Full cycle reset**: Clicking indicator on `- [f] Task` writes `- [ ] Task` (cycle wraps)
7. **View toggle**: Clicking "Files" switches from File Tree to Task List and back
8. **Persistence**: View preference survives page reload
9. **Mobile parity**: Task List accessible via same hamburger menu as File Tree
10. **Empty state**: Vault with no tasks displays "No tasks found" message
11. **Write failure**: When file is read-only, clicking checkbox shows error toast and checkbox remains unchanged

## Open Questions

- [x] What task states should be supported? **Decision**: Six states with distinct meanings (space, x, /, ?, b, f) and visual indicators

## Out of Scope

- Task creation or editing (beyond checkbox toggle)
- Task filtering, search, or sorting options
- Due dates or priority parsing
- Drag-and-drop reordering
- Sync with external task managers

---

**Next Phase**: Once approved, use `/spiral-grove:plan-generation` to create technical implementation plan.
