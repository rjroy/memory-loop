---
version: 1.0.0
status: Draft
created: 2025-12-26
last_updated: 2025-12-26
authored_by:
  - Claude Code (Reverse-Engineered)
---

# Home Dashboard Feature Specification

**Reverse-Engineered**: true
**Source Module**: frontend/src/components/HomeView.tsx, backend/src/inspiration-manager.ts

## Executive Summary

The Home Dashboard is the default landing view when a vault is selected in Memory Loop. It provides users with a comprehensive overview of their current session, goals, inspiration, and recent activity across both note captures and AI discussions. The dashboard acts as a central hub that helps users quickly assess their progress, get motivated with personalized content, and resume recent work. It displays four primary sections: session context (vault name and stats), inspiration quotes, personal goals, and recent activity (both captures and discussions).

The dashboard is designed for mobile-first interaction with a focus on quick glanceability and one-tap actions. All content is dynamically loaded via WebSocket messages and gracefully handles missing data (empty states, fallbacks, and skeleton loaders).

## User Story

As an Obsidian vault user working through Memory Loop, I want to see a personalized dashboard when I select my vault, so that I can quickly understand my current session context, stay motivated with relevant inspiration, review my goals, and resume recent work without navigating through multiple views.

## Stakeholders

- **Primary**: Obsidian vault users accessing Memory Loop via mobile web browser
- **Secondary**: Desktop users who want quick access to session overview and recent activity

## Success Criteria

1. **Glanceability**: Users can assess session state, goals, and recent activity within 3 seconds of loading
2. **Personalization**: Contextual prompts reflect actual vault content (recent notes, projects, areas) on weekdays
3. **Quick Resume**: Users can resume a discussion or view a note capture with a single tap
4. **Graceful Degradation**: Dashboard displays useful content even when goals file, inspiration files, or recent activity is unavailable

## Functional Requirements

### Session Context Display

- **REQ-F-1**: System must display the currently selected vault name prominently at the top of the dashboard
- **REQ-F-2**: System must display session duration in human-readable format (hours and minutes, or minutes only if less than 1 hour)
- **REQ-F-3**: System must display the total number of messages exchanged in the current session
- **REQ-F-4**: Session duration must update dynamically based on session start time

### Inspiration Content

- **REQ-F-5**: System must display exactly two types of inspiration content: one contextual prompt (weekdays only) and one inspirational quote (always)
- **REQ-F-6**: Contextual prompts must only be displayed on weekdays (Monday-Friday), not on weekends
- **REQ-F-7**: Inspirational quotes must always be displayed, using a hardcoded fallback if the quote file is missing or empty
- **REQ-F-8**: Clicking an inspiration item (prompt or quote) must prefill the discussion input and switch to discussion mode
- **REQ-F-9**: System must show a skeleton loader for inspiration content while data is being fetched
- **REQ-F-10**: Inspiration content must be randomly selected from available pools on each dashboard load

### Goals Display

- **REQ-F-11**: System must display goals parsed from the vault's `06_Metadata/memory-loop/goals.md` file (if it exists)
- **REQ-F-12**: Goals must be organized by sections, with each section displaying its markdown header as a title
- **REQ-F-13**: Each goal section must display up to 9 items as a bulleted list
- **REQ-F-14**: If a goal section has more than 9 items, the system must display "..." to indicate truncation
- **REQ-F-15**: Goals card must not render if the vault has no goals file or if the file is empty
- **REQ-F-16**: Goals are only requested if the vault has a `goalsPath` set during vault discovery

### Recent Activity

- **REQ-F-17**: System must display recent note captures from the vault inbox, showing up to the most recent entries
- **REQ-F-18**: Each note capture card must display: note text, capture time (HH:MM format), and relative date (Today/Yesterday/YYYY-MM-DD)
- **REQ-F-19**: Note capture cards must hide the date label for "Today" entries (only show time)
- **REQ-F-20**: Each note capture card must have a "View" button that opens the daily note file in browse mode
- **REQ-F-21**: System must display recent discussion sessions, showing up to the most recent entries
- **REQ-F-22**: Each discussion card must display: message preview, session time, relative date, and message count
- **REQ-F-23**: Each discussion card must have a "Resume" button that sends `resume_session` and switches to discussion mode
- **REQ-F-24**: Relative date formatting must display "Today" for today's date, "Yesterday" for yesterday's date, and raw YYYY-MM-DD for older dates
- **REQ-F-25**: Recent Activity section must not render if there are no captures and no discussions

### WebSocket Communication

- **REQ-F-26**: On WebSocket connect, the system must send a `select_vault` message with the vault ID
- **REQ-F-27**: After receiving `session_ready` response, the system must request recent activity, goals (if vault has goals file), and inspiration
- **REQ-F-28**: System must handle `recent_activity` messages and update the context with captures and discussions arrays
- **REQ-F-29**: System must handle `goals` messages and update the context with goal sections
- **REQ-F-30**: System must handle `inspiration` messages and update the context with contextual prompt and quote
- **REQ-F-31**: On WebSocket reconnect, the system must re-send vault selection and re-request all dashboard data

### Inspiration Generation (Backend)

- **REQ-F-32**: System must check if contextual prompt generation is needed (weekday + not generated today)
- **REQ-F-33**: System must check if quote generation is needed (not generated this ISO week)
- **REQ-F-34**: Contextual prompts must be generated using day-specific context: Monday (last 7 daily notes + projects), Tuesday-Thursday (yesterday's note only), Friday (current week's notes + areas)
- **REQ-F-35**: System must generate exactly 5 new contextual prompts per generation cycle using Claude Haiku
- **REQ-F-36**: System must generate exactly 1 new inspirational quote per week using Claude Haiku
- **REQ-F-37**: Quotes must be context-aware, drawing from themes evident in the user's recent notes
- **REQ-F-38**: Generated prompts and quotes must be appended to their respective files (not overwrite existing content)
- **REQ-F-39**: Inspiration pools must be pruned to a maximum of 50 entries, removing oldest entries first
- **REQ-F-40**: Contextual prompts must be stored in `06_Metadata/memory-loop/contextual-prompts.md`
- **REQ-F-41**: Inspirational quotes must be stored in `06_Metadata/memory-loop/general-inspiration.md`

### Context Gathering for Generation

- **REQ-F-42**: System must gather context from daily notes in `00_Inbox/` with YYYY-MM-DD.md pattern
- **REQ-F-43**: On Monday, system must read last 7 daily notes and all README/index.md files from `01_Projects/`
- **REQ-F-44**: On Tuesday-Thursday, system must read only yesterday's daily note
- **REQ-F-45**: On Friday, system must read current week's daily notes (Mon-Fri) and all README/index.md files from `02_Areas/`
- **REQ-F-46**: Gathered context must be capped at ~800 tokens (~3200 characters), truncating oldest content first

## Non-Functional Requirements

- **REQ-NF-1** (Performance): Dashboard data requests must be sent immediately after `session_ready` response to minimize perceived load time
- **REQ-NF-2** (Performance): Inspiration generation must not block the response to the `get_inspiration` request (generation happens, then file is parsed)
- **REQ-NF-3** (Performance): Session duration formatting must be computed client-side without additional network requests
- **REQ-NF-4** (Cost Efficiency): Inspiration generation must use Claude Haiku model (claude-3-haiku-20240307) to minimize API costs
- **REQ-NF-5** (Usability): Skeleton loader for inspiration must be visually distinct to indicate loading state
- **REQ-NF-6** (Usability): All clickable inspiration items must have clear accessibility labels ("Use this prompt for discussion", "Use this quote for discussion")
- **REQ-NF-7** (Accessibility): Session context card must have `aria-label="Session context"` landmark
- **REQ-NF-8** (Accessibility): Goals card must have `aria-label="Goals"` region landmark
- **REQ-NF-9** (Accessibility): Recent activity section must have `aria-label="Recent activity"` region landmark
- **REQ-NF-10** (Accessibility): Visual bullets in goal lists must be hidden from screen readers with `aria-hidden="true"`
- **REQ-NF-11** (Reliability): Dashboard must gracefully handle missing inspiration files by using fallback quote for quotes and null for contextual prompts
- **REQ-NF-12** (Reliability): Dashboard must gracefully handle empty goals file by not rendering the goals card
- **REQ-NF-13** (Reliability): Dashboard must prevent duplicate data requests by tracking request state with refs
- **REQ-NF-14** (Reliability): AI generation failures must not crash the system or block dashboard display (errors logged, empty arrays returned)
- **REQ-NF-15** (Maintainability): BEM CSS naming convention must be used for all dashboard components (e.g., `home-view__vault-name`, `inspiration-card__text`)

## Explicit Constraints (DO NOT)

- Do NOT request goals if the vault does not have a `goalsPath` property (would result in 404 error)
- Do NOT display contextual prompts on weekends (Saturday/Sunday) even if the file contains prompts
- Do NOT show date labels for "Today" entries in recent activity (clutters the UI)
- Do NOT generate inspiration content on weekends (no contextual generation, quotes only generate once per week)
- Do NOT block dashboard rendering while waiting for inspiration generation (async, non-blocking)
- Do NOT overwrite existing inspiration files during generation (always append)
- Do NOT allow inspiration pools to exceed 50 entries (prune automatically)
- Do NOT use expensive models for inspiration generation (must use Haiku for cost efficiency)
- Do NOT send multiple `get_recent_activity`, `get_goals`, or `get_inspiration` requests on the same WebSocket connection (use refs to track)
- Do NOT display goals card if `goals` context value is `null` or an empty array

## Technical Context

### Existing Stack

- **Frontend**: React 19, TypeScript (strict mode), Vite, Bun for testing
- **Backend**: Hono server, Bun runtime, Claude Agent SDK
- **Shared**: Zod schemas for WebSocket protocol validation
- **State Management**: SessionContext (React Context API)
- **WebSocket**: Custom `useWebSocket` hook with reconnection handling

### Integration Points

- **SessionContext**: Provides `vault`, `messages`, `sessionStartTime`, `goals`, `recentNotes`, `recentDiscussions`, `setMode`, `setCurrentPath`, `setDiscussionPrefill`, `setRecentNotes`, `setRecentDiscussions`, `setGoals`
- **WebSocket Protocol**:
  - Sends: `select_vault`, `get_recent_activity`, `get_goals`, `get_inspiration`
  - Receives: `session_ready`, `recent_activity`, `goals`, `inspiration`
- **VaultManager**: Provides vault discovery with `goalsPath` detection
- **SessionManager**: Provides `getRecentDiscussions()` to retrieve session summaries
- **NoteCapture**: Provides `getRecentCaptures()` to retrieve recent note entries
- **InspirationManager**: Provides `getInspiration(vaultPath)` for contextual prompts and quotes

### Patterns to Respect

- **Refs for WebSocket Stability**: Use `useRef` to track whether requests have been sent to prevent duplicate requests on re-renders or reconnects
- **Callback Refs**: Store `sendMessage` in a ref to avoid stale closures in event handlers
- **Single Message Handler**: Use a single `handleMessage` callback in `useWebSocket` to avoid race conditions from multiple handlers
- **Graceful Null Handling**: Always check for `null` or empty arrays before rendering sections (goals, recent activity, contextual prompts)
- **Skeleton Loaders**: Show loading states for async content (inspiration card)
- **BEM CSS**: Use block__element--modifier naming (e.g., `home-view`, `home-view__vault-name`, `recent-activity__card--capture`)

## Acceptance Tests

1. **Session Context Display**: Given a vault is selected, when the dashboard loads, then the vault name, session duration, and message count (0 initially) are displayed
2. **Inspiration on Weekdays**: Given it is a weekday (Monday-Friday), when inspiration data is loaded, then both a contextual prompt and an inspirational quote are displayed
3. **Inspiration on Weekends**: Given it is a weekend (Saturday or Sunday), when inspiration data is loaded, then only an inspirational quote is displayed (no contextual prompt)
4. **Inspiration Click Prefills Discussion**: Given an inspiration item is displayed, when the user clicks it, then the discussion input is prefilled with the item's text and the mode switches to "discussion"
5. **Goals Display**: Given the vault has a `goals.md` file with sections, when the dashboard loads, then each section is displayed with its title and up to 9 items
6. **Goals Truncation Indicator**: Given a goal section has more than 9 items, when the section is rendered, then "..." is displayed after the 9th item
7. **No Goals Card for Missing File**: Given the vault has no goals file, when the dashboard loads, then the goals card is not rendered
8. **Recent Captures Display**: Given there are recent note captures, when the dashboard loads, then each capture shows its text, time, and relative date (hiding "Today" label)
9. **View Capture Navigation**: Given a note capture card is displayed, when the user clicks "View", then the system navigates to browse mode and loads the daily note file
10. **Recent Discussions Display**: Given there are recent discussion sessions, when the dashboard loads, then each discussion shows its preview, time, relative date, and message count
11. **Resume Discussion**: Given a discussion card is displayed, when the user clicks "Resume", then the system sends `resume_session` with the session ID and switches to discussion mode
12. **Empty Recent Activity**: Given there are no captures and no discussions, when the dashboard loads, then the Recent Activity section is not rendered
13. **Relative Date for Today**: Given a capture or discussion occurred today, when the card is rendered, then only the time is displayed (no date label)
14. **Relative Date for Yesterday**: Given a capture or discussion occurred yesterday, when the card is rendered, then "Yesterday" is displayed alongside the time
15. **Relative Date for Older Entries**: Given a capture or discussion occurred more than 1 day ago, when the card is rendered, then the raw YYYY-MM-DD date is displayed
16. **WebSocket Reconnect Re-requests Data**: Given the WebSocket connection is lost and then reconnected, when the connection is re-established, then the system re-sends `select_vault` and re-requests recent activity, goals, and inspiration
17. **Contextual Generation Triggered on Monday**: Given it is Monday and contextual prompts have not been generated today, when `get_inspiration` is called, then the system gathers last 7 daily notes + projects and generates 5 new prompts
18. **Quote Generation Triggered Once Per Week**: Given the current ISO week number differs from the last generation week, when `get_inspiration` is called, then the system generates 1 new quote with context awareness
19. **Fallback Quote on Missing File**: Given the quote file does not exist or is empty, when inspiration is requested, then the system returns the hardcoded fallback quote ("The only way to do great work is to love what you do." -- Steve Jobs)
20. **Inspiration Pool Pruning**: Given an inspiration file has more than 50 entries after generation, when new entries are appended, then the oldest entries are removed to maintain a pool size of 50

## Open Questions

- [ ] Should the dashboard support manual refresh of inspiration content without reconnecting WebSocket?
- [ ] Should session duration update in real-time (e.g., every minute) or remain static after initial load?
- [ ] Should the "View" button for captures support deep linking to a specific section within the daily note?
- [ ] Should the dashboard display a visual indicator when new captures or discussions are added during an active session?
- [ ] Should the system cache inspiration content in SessionContext to avoid re-requesting on every dashboard view?

## Out of Scope

- **Real-time Dashboard Updates**: Dashboard does not automatically refresh when new captures or discussions are created during the session (requires manual navigation away and back)
- **Filtering Recent Activity**: Users cannot filter recent activity by date range or content type
- **Editing Goals from Dashboard**: Goals must be edited directly in the `goals.md` file; dashboard is read-only
- **Custom Inspiration Sources**: Users cannot configure alternative sources for quotes or prompts
- **Inspiration History**: Dashboard does not show previously displayed inspiration items
- **Session Statistics Beyond Count**: No metrics like total tokens used, average response time, or session quality score
- **Multi-Vault Session Context**: Dashboard only shows context for the currently selected vault, not aggregated across multiple vaults
- **Pinning Favorite Inspiration Items**: Users cannot pin or favorite specific prompts or quotes for later reference

---

**Next Phase**: Once approved, use `/spiral-grove:plan-generation` to create technical implementation plan.
